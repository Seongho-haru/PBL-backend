{
  "info": {
    "name": "PBL Report Management APIs",
    "description": "신고 관리 API 테스트 컬렉션\n\n**주요 기능:**\n- 부적절한 콘텐츠 신고\n- 관리자 신고 처리 (삭제, 정지, 경고 등)\n- 신고 통계 조회",
    "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
  },
  "variable": [
    {
      "key": "base_url",
      "value": "http://114.201.56.70:2358",
      "type": "string"
    },
    {
      "key": "user_id",
      "value": "1",
      "type": "string",
      "description": "관리자 ID"
    },
    {
      "key": "report_id",
      "value": "",
      "type": "string"
    },
    {
      "key": "target_type",
      "value": "CURRICULUM",
      "type": "string",
      "description": "신고 대상 타입: CURRICULUM, LECTURE, QUESTION, ANSWER, COURSE_REVIEW"
    },
    {
      "key": "target_id",
      "value": "1",
      "type": "string"
    }
  ],
  "item": [
    {
      "name": "1. 신고 작성",
      "request": {
        "method": "POST",
        "header": [
          {
            "key": "X-User-Id",
            "value": "{{user_id}}",
            "type": "text"
          },
          {
            "key": "Content-Type",
            "value": "application/json",
            "type": "text"
          }
        ],
        "body": {
          "mode": "raw",
          "raw": "{\n  \"targetType\": \"{{target_type}}\",\n  \"targetId\": {{target_id}},\n  \"reason\": \"ABUSE\",\n  \"content\": \"욕설 및 혐오 표현이 포함되어 있습니다.\"\n}"
        },
        "url": {
          "raw": "{{base_url}}/api/reports",
          "host": ["{{base_url}}"],
          "path": ["api", "reports"]
        }
      },
      "response": [],
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "if (pm.response.code === 200) {",
              "    const response = pm.response.json();",
              "    pm.collectionVariables.set('report_id', response.id);",
              "}"
            ]
          }
        }
      ]
    },
    {
      "name": "2. 신고 목록 조회 (전체)",
      "request": {
        "method": "GET",
        "header": [
          {
            "key": "X-User-Id",
            "value": "{{user_id}}",
            "type": "text"
          }
        ],
        "url": {
          "raw": "{{base_url}}/api/reports?page=0&size=20",
          "host": ["{{base_url}}"],
          "path": ["api", "reports"],
          "query": [
            {
              "key": "page",
              "value": "0",
              "description": "페이지 번호"
            },
            {
              "key": "size",
              "value": "20",
              "description": "페이지 크기"
            }
          ]
        }
      },
      "response": []
    },
    {
      "name": "3. 신고 목록 조회 (필터링 - PENDING)",
      "request": {
        "method": "GET",
        "header": [
          {
            "key": "X-User-Id",
            "value": "{{user_id}}",
            "type": "text"
          }
        ],
        "url": {
          "raw": "{{base_url}}/api/reports?status=PENDING&page=0&size=20",
          "host": ["{{base_url}}"],
          "path": ["api", "reports"],
          "query": [
            {
              "key": "status",
              "value": "PENDING",
              "description": "신고 상태"
            },
            {
              "key": "page",
              "value": "0"
            },
            {
              "key": "size",
              "value": "20"
            }
          ]
        }
      },
      "response": []
    },
    {
      "name": "4. 신고 목록 조회 (타입별)",
      "request": {
        "method": "GET",
        "header": [
          {
            "key": "X-User-Id",
            "value": "{{user_id}}",
            "type": "text"
          }
        ],
        "url": {
          "raw": "{{base_url}}/api/reports?targetType=QUESTION&page=0&size=20",
          "host": ["{{base_url}}"],
          "path": ["api", "reports"],
          "query": [
            {
              "key": "targetType",
              "value": "QUESTION",
              "description": "신고 대상 타입"
            },
            {
              "key": "page",
              "value": "0"
            },
            {
              "key": "size",
              "value": "20"
            }
          ]
        }
      },
      "response": []
    },
    {
      "name": "5. 신고 상세 조회",
      "request": {
        "method": "GET",
        "header": [
          {
            "key": "X-User-Id",
            "value": "{{user_id}}",
            "type": "text"
          }
        ],
        "url": {
          "raw": "{{base_url}}/api/reports/{{report_id}}",
          "host": ["{{base_url}}"],
          "path": ["api", "reports", "{{report_id}}"]
        }
      },
      "response": []
    },
    {
      "name": "6. 신고 처리 - 콘텐츠 삭제",
      "request": {
        "method": "PUT",
        "header": [
          {
            "key": "X-User-Id",
            "value": "{{user_id}}",
            "type": "text"
          },
          {
            "key": "Content-Type",
            "value": "application/json",
            "type": "text"
          }
        ],
        "body": {
          "mode": "raw",
          "raw": "{\n  \"status\": \"RESOLVED\",\n  \"processAction\": \"DELETE_CONTENT\",\n  \"processNote\": \"욕설로 인해 콘텐츠 삭제 처리\"\n}"
        },
        "url": {
          "raw": "{{base_url}}/api/reports/{{report_id}}/process",
          "host": ["{{base_url}}"],
          "path": ["api", "reports", "{{report_id}}", "process"]
        }
      },
      "response": []
    },
    {
      "name": "7. 신고 처리 - 사용자 정지",
      "request": {
        "method": "PUT",
        "header": [
          {
            "key": "X-User-Id",
            "value": "{{user_id}}",
            "type": "text"
          },
          {
            "key": "Content-Type",
            "value": "application/json",
            "type": "text"
          }
        ],
        "body": {
          "mode": "raw",
          "raw": "{\n  \"status\": \"RESOLVED\",\n  \"processAction\": \"MUTE_USER\",\n  \"processNote\": \"반복적인 부적절한 행동으로 인해 7일간 정지 처리\"\n}"
        },
        "url": {
          "raw": "{{base_url}}/api/reports/{{report_id}}/process",
          "host": ["{{base_url}}"],
          "path": ["api", "reports", "{{report_id}}", "process"]
        }
      },
      "response": []
    },
    {
      "name": "8. 신고 처리 - 경고",
      "request": {
        "method": "PUT",
        "header": [
          {
            "key": "X-User-Id",
            "value": "{{user_id}}",
            "type": "text"
          },
          {
            "key": "Content-Type",
            "value": "application/json",
            "type": "text"
          }
        ],
        "body": {
          "mode": "raw",
          "raw": "{\n  \"status\": \"RESOLVED\",\n  \"processAction\": \"WARNING\",\n  \"processNote\": \"경고 처리 - 3회 누적 시 자동 정지\"\n}"
        },
        "url": {
          "raw": "{{base_url}}/api/reports/{{report_id}}/process",
          "host": ["{{base_url}}"],
          "path": ["api", "reports", "{{report_id}}", "process"]
        }
      },
      "response": []
    },
    {
      "name": "9. 신고 통계 조회",
      "request": {
        "method": "GET",
        "header": [
          {
            "key": "X-User-Id",
            "value": "{{user_id}}",
            "type": "text"
          }
        ],
        "url": {
          "raw": "{{base_url}}/api/reports/stats",
          "host": ["{{base_url}}"],
          "path": ["api", "reports", "stats"]
        }
      },
      "response": [],
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "pm.test('Status code is 200', () => {",
              "    pm.response.to.have.status(200);",
              "});",
              "",
              "pm.test('Response contains statistics', () => {",
              "    const jsonData = pm.response.json();",
              "    pm.expect(jsonData).to.have.property('totalReports');",
              "    pm.expect(jsonData).to.have.property('pendingCount');",
              "    pm.expect(jsonData).to.have.property('resolvedCount');",
              "});"
            ]
          }
        }
      ]
    },
    {
      "name": "10. 내 신고 목록 조회",
      "request": {
        "method": "GET",
        "header": [
          {
            "key": "X-User-Id",
            "value": "{{user_id}}",
            "type": "text"
          }
        ],
        "url": {
          "raw": "{{base_url}}/api/reports/my",
          "host": ["{{base_url}}"],
          "path": ["api", "reports", "my"]
        }
      },
      "response": []
    },
    {
      "name": "11. 신고 취소",
      "request": {
        "method": "DELETE",
        "header": [
          {
            "key": "X-User-Id",
            "value": "{{user_id}}",
            "type": "text"
          }
        ],
        "url": {
          "raw": "{{base_url}}/api/reports/{{report_id}}",
          "host": ["{{base_url}}"],
          "path": ["api", "reports", "{{report_id}}"]
        }
      },
      "response": []
    },
    {
      "name": "12. [정지 사용자] 질문 작성 시도 (차단 확인)",
      "request": {
        "method": "POST",
        "header": [
          {
            "key": "X-User-Id",
            "value": "2",
            "description": "정지된 사용자 ID (예시)",
            "type": "text"
          },
          {
            "key": "Content-Type",
            "value": "application/json",
            "type": "text"
          }
        ],
        "body": {
          "mode": "raw",
          "raw": "{\n  \"title\": \"정지 상태인데 글쓰기 시도\",\n  \"content\": \"이 글은 작성되지 않아야 합니다.\",\n  \"category\": \"QUESTION\",\n  \"course\": \"테스트\",\n  \"language\": \"Java\"\n}"
        },
        "url": {
          "raw": "{{base_url}}/api/qna/questions",
          "host": ["{{base_url}}"],
          "path": ["api", "qna", "questions"]
        }
      },
      "response": [],
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "pm.test('Status code should be error (403 or 400)', () => {",
              "    pm.expect([400, 403, 500]).to.include(pm.response.code);",
              "});",
              "",
              "pm.test('Error message contains mute/정지', () => {",
              "    const jsonData = pm.response.json();",
              "    const errorMsg = JSON.stringify(jsonData).toLowerCase();",
              "    pm.expect(errorMsg).to.include('정지');",
              "});"
            ]
          }
        }
      ]
    },
    {
      "name": "13. [정지 사용자] 리뷰 작성 시도 (차단 확인)",
      "request": {
        "method": "POST",
        "header": [
          {
            "key": "X-User-Id",
            "value": "2",
            "description": "정지된 사용자 ID (예시)",
            "type": "text"
          },
          {
            "key": "Content-Type",
            "value": "application/json",
            "type": "text"
          }
        ],
        "body": {
          "mode": "raw",
          "raw": "{\n  \"isReview\": true,\n  \"rating\": 5.0,\n  \"content\": \"정지 상태인데 리뷰 작성 시도\"\n}"
        },
        "url": {
          "raw": "{{base_url}}/api/curriculums/{{target_id}}/reviews",
          "host": ["{{base_url}}"],
          "path": ["api", "curriculums", "{{target_id}}", "reviews"]
        }
      },
      "response": [],
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "pm.test('Status code should be error', () => {",
              "    pm.expect([400, 403, 500]).to.include(pm.response.code);",
              "});",
              "",
              "pm.test('Error message contains mute/정지', () => {",
              "    const jsonData = pm.response.json();",
              "    const errorMsg = JSON.stringify(jsonData).toLowerCase();",
              "    pm.expect(errorMsg).to.include('정지');",
              "});"
            ]
          }
        }
      ]
    },
    {
      "name": "14. [정지 사용자] 답변 작성 시도 (차단 확인)",
      "request": {
        "method": "POST",
        "header": [
          {
            "key": "X-User-Id",
            "value": "2",
            "description": "정지된 사용자 ID (예시)",
            "type": "text"
          },
          {
            "key": "Content-Type",
            "value": "application/json",
            "type": "text"
          }
        ],
        "body": {
          "mode": "raw",
          "raw": "{\n  \"content\": \"정지 상태인데 답변 작성 시도\"\n}"
        },
        "url": {
          "raw": "{{base_url}}/api/qna/answers/questions/1",
          "host": ["{{base_url}}"],
          "path": ["api", "qna", "answers", "questions", "1"]
        }
      },
      "response": [],
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "pm.test('Status code should be error', () => {",
              "    pm.expect([400, 403, 500]).to.include(pm.response.code);",
              "});",
              "",
              "pm.test('Error message contains mute/정지', () => {",
              "    const jsonData = pm.response.json();",
              "    const errorMsg = JSON.stringify(jsonData).toLowerCase();",
              "    pm.expect(errorMsg).to.include('정지');",
              "});"
            ]
          }
        }
      ]
    },
    {
      "name": "15. [정상 사용자] 질문 작성 (정상 동작 확인)",
      "request": {
        "method": "POST",
        "header": [
          {
            "key": "X-User-Id",
            "value": "3",
            "description": "정상 사용자 ID (정지되지 않음)",
            "type": "text"
          },
          {
            "key": "Content-Type",
            "value": "application/json",
            "type": "text"
          }
        ],
        "body": {
          "mode": "raw",
          "raw": "{\n  \"title\": \"정상 사용자의 질문\",\n  \"content\": \"정지되지 않은 사용자는 글을 작성할 수 있습니다.\",\n  \"category\": \"QUESTION\",\n  \"course\": \"테스트\",\n  \"language\": \"Java\"\n}"
        },
        "url": {
          "raw": "{{base_url}}/api/qna/questions",
          "host": ["{{base_url}}"],
          "path": ["api", "qna", "questions"]
        }
      },
      "response": [],
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "pm.test('Status code should be 201 (Created)', () => {",
              "    pm.response.to.have.status(201);",
              "});",
              "",
              "pm.test('Response contains created question', () => {",
              "    const jsonData = pm.response.json();",
              "    pm.expect(jsonData).to.have.property('id');",
              "    pm.expect(jsonData).to.have.property('title');",
              "});"
            ]
          }
        }
      ]
    }
  ]
}
