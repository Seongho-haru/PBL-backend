# 🎓 PBL 수강 관리 API 테스트 가이드

## 📋 개요

이 가이드는 **수강 관리 모듈의 모든 API**를 체계적으로 테스트하기 위한 Postman Collection 사용법을 설명합니다.

---

## 🚀 시작하기

### 1. Postman Collection 가져오기

1. Postman 실행
2. **Import** 버튼 클릭
3. `PBL_Enrollment_Management.postman_collection.json` 파일 선택
4. **Import** 완료

### 2. 환경 설정 확인

- **Base URL**: `http://localhost:2358` (자동 설정됨)
- 애플리케이션이 실행 중인지 확인

### 3. 테스트 데이터 준비

테스트 전에 다음 데이터가 필요합니다:

#### **사용자 데이터**

- `userId1`: 테스트용 사용자 1 (수강자)
- `userId2`: 테스트용 사용자 2 (권한 체크용)

#### **커리큘럼 데이터**

- `curriculumId`: 공개된 커리큘럼 ID
- `markdownLectureId`: 마크다운 강의 ID
- `problemLectureId`: 문제 강의 ID

---

## 📊 테스트 구조

### 🎯 **1. 수강 신청/취소** (3개 테스트)

1. **커리큘럼 수강 신청** - 정상 케이스
2. **중복 수강 신청 시도** - 실패 케이스
3. **수강 취소** - 정상 케이스

### 📈 **2. 진도 관리** (2개 테스트)

1. **마크다운 강의 읽기 완료** - 정상 케이스
2. **문제 강의 정답 제출** - 정상 케이스

### 🔍 **3. 조회 기능** (3개 테스트)

1. **사용자별 수강 목록 조회** - 전체 목록
2. **수강 상태별 목록 조회** - 수강중만 필터링
3. **수강 상세 정보 조회** - 강의별 진도 포함

### 📊 **4. 통계 기능** (2개 테스트)

1. **커리큘럼별 수강자 수 조회** - 전체 수강자
2. **커리큘럼별 완료자 수 조회** - 완료한 수강자

### 🔒 **5. 권한 체크** (2개 테스트)

1. **다른 사용자 수강 목록 조회 시도** - 403 Forbidden
2. **X-User-Id 헤더 없이 요청** - 400 Bad Request

### ❌ **6. 에러 케이스** (2개 테스트)

1. **존재하지 않는 커리큘럼 수강 신청** - 400 Bad Request
2. **존재하지 않는 수강 정보 조회** - 404 Not Found

---

## 🧪 테스트 시나리오

### **시나리오 1: 완전한 수강 과정**

1. **커리큘럼 수강 신청** → 수강 ID 저장
2. **수강 상세 정보 조회** → 강의 목록 확인
3. **마크다운 강의 읽기 완료** → 진도 업데이트
4. **문제 강의 정답 제출** → 진도 업데이트
5. **수강 상세 정보 조회** → 진도율 확인
6. **수강자 수 조회** → 통계 확인

### **시나리오 2: 권한 및 보안 테스트**

1. **다른 사용자 수강 목록 조회** → 403 에러 확인
2. **헤더 없이 요청** → 400 에러 확인
3. **존재하지 않는 리소스 조회** → 404 에러 확인

### **시나리오 3: 중복 방지 테스트**

1. **커리큘럼 수강 신청** → 성공
2. **같은 커리큘럼 재신청** → 409 에러 확인
3. **수강 취소** → 성공
4. **다시 수강 신청** → 성공

---

## 🔧 환경 변수 설정

### **자동 설정 (Collection Level)**

Collection을 import하면 다음 변수들이 자동으로 설정됩니다:

```json
{
  "baseUrl": "http://localhost:2358",
  "userId1": "1",
  "userId2": "2",
  "curriculumId": "1",
  "markdownLectureId": "1",
  "problemLectureId": "2"
}
```

### **수동 설정 (필요시)**

실제 데이터에 맞게 환경 변수를 수정하세요:

1. Postman에서 **Environments** 탭 선택
2. **Create Environment** 클릭
3. 다음 변수들 추가:

| Variable            | Initial Value           | Current Value           | Description          |
| ------------------- | ----------------------- | ----------------------- | -------------------- |
| `baseUrl`           | `http://localhost:2358` | `http://localhost:2358` | API 기본 URL         |
| `userId1`           | `1`                     | `1`                     | 테스트용 사용자 1 ID |
| `userId2`           | `2`                     | `2`                     | 테스트용 사용자 2 ID |
| `curriculumId`      | `1`                     | `1`                     | 공개 커리큘럼 ID     |
| `markdownLectureId` | `1`                     | `1`                     | 마크다운 강의 ID     |
| `problemLectureId`  | `2`                     | `2`                     | 문제 강의 ID         |
| `enrollmentId`      | -                       | -                       | 수강 ID (자동 설정)  |

---

## ✅ 테스트 검증 항목

### **응답 코드 검증**

- `200 OK`: 조회 성공
- `201 Created`: 수강 신청 성공
- `400 Bad Request`: 잘못된 요청
- `403 Forbidden`: 권한 없음
- `404 Not Found`: 리소스 없음
- `409 Conflict`: 중복 수강

### **응답 데이터 검증**

#### **수강 신청 응답**

```json
{
  "id": 1,
  "userId": 1,
  "username": "사용자명",
  "curriculumId": 1,
  "curriculumTitle": "커리큘럼 제목",
  "status": "ENROLLED",
  "progressPercentage": 0,
  "enrolledAt": "2025-01-01T00:00:00"
}
```

#### **수강 상세 정보 응답**

```json
{
  "id": 1,
  "userId": 1,
  "username": "사용자명",
  "curriculumId": 1,
  "curriculumTitle": "커리큘럼 제목",
  "status": "ENROLLED",
  "progressPercentage": 50,
  "lectures": [
    {
      "id": 1,
      "lectureId": 1,
      "lectureTitle": "강의 제목",
      "status": "COMPLETED",
      "order": 1,
      "isRequired": true
    }
  ]
}
```

---

## 🚨 주의사항

### **테스트 순서**

1. **사전 준비**: 사용자, 커리큘럼, 강의 데이터 생성
2. **수강 신청**: 먼저 수강 신청 후 다른 테스트 진행
3. **진도 관리**: 수강 신청 후 진도 업데이트 테스트
4. **조회 기능**: 수강 신청 후 조회 테스트
5. **권한 체크**: 언제든지 테스트 가능

### **데이터 의존성**

- 수강 신청 테스트는 공개 커리큘럼이 필요
- 진도 관리 테스트는 수강 신청이 선행되어야 함
- 수강 상세 조회는 수강 신청이 선행되어야 함

### **환경 변수 관리**

- `enrollmentId`는 수강 신청 성공 시 자동 설정됨
- 다른 사용자 ID로 권한 테스트 시 `userId2` 사용
- 실제 데이터에 맞게 ID 값들 수정 필요

---

## 📞 문제 해결

### **자주 발생하는 오류**

1. **404 Not Found**: 커리큘럼이나 강의 ID가 잘못됨
2. **403 Forbidden**: 권한 체크 실패 (본인 데이터만 조회 가능)
3. **409 Conflict**: 중복 수강 신청
4. **400 Bad Request**: X-User-Id 헤더 누락

### **디버깅 팁**

1. **응답 로그 확인**: 서버 로그에서 상세 오류 메시지 확인
2. **환경 변수 확인**: Postman에서 변수 값이 올바른지 확인
3. **데이터베이스 확인**: 실제 데이터가 존재하는지 확인
4. **헤더 확인**: X-User-Id 헤더가 모든 요청에 포함되었는지 확인

---

## 🎯 성공 기준

모든 테스트가 성공하면 다음이 확인됩니다:

- ✅ 수강 신청/취소 기능 정상 작동
- ✅ 진도 관리 기능 정상 작동
- ✅ 조회 기능 정상 작동
- ✅ 통계 기능 정상 작동
- ✅ 권한 체크 정상 작동
- ✅ 에러 처리 정상 작동

**총 14개 테스트 케이스 모두 통과**하면 수강 관리 모듈이 정상적으로 구현된 것입니다!
